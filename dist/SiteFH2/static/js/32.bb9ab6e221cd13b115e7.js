webpackJsonp([32],{359:function(t,e,s){var i=s(0)(s(699),s(907),null,null);t.exports=i.exports},614:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=(s(6),function(t){return t.replace(/[\u0391-\uFFE5]/g,"aa").length});e.default={name:"ComLuckyWheel",props:{activity:{type:Object,required:!0},leftTimes:{type:Number,required:!0},prize:{type:Object,required:!0},lucky2:{type:Boolean,required:!1}},data:function(){return{rotate:0,fakeRotating:!1,busy:!1,lights:33,isShowWarning:!1,transition:"1s ease-in",startanimation:!1}},computed:{isUserLogined:function(){return this.$store.state.user.isUserLogined},systemDateTime:function(){return this.$store.state.systemDateTime},message:function(){if(this.systemDateTime&&this.activity){if(this.activity.error)return this.activity.error;if(-1===this.activity.id)return"当前活动未开始";if(new Date(this.activity.starttime)>new Date(this.systemDateTime))return"当前活动未开始";if(new Date(this.activity.endtime)<=new Date(this.systemDateTime))return"当前活动已结束"}},prizesWithStyle:function(){var t=this,e=[];return this.activity.items&&this.activity.items.forEach(function(s,a){var r={prize:s,partStyle:{transform:"rotate("+t._getPartTurn(a)+"turn) skewY("+(1/t.activity.items.length+.25)+"turn)"},prizeStyle:{transform:"rotate("+t._getPrizeTurn(a)+"turn)"}};if(s.worddesc){var n=s.worddesc.split(/[-|]/),o=i(n[n.length-1]);s.worddesc.indexOf("-")>-1&&(s.worddesc=s.worddesc.replace(/-/g,'<p class="wheel__prize-sep"><span>l</span></p>')),s.worddesc=s.worddesc.replace(/\|/g,"<br>");var c=3200/o/t.activity.items.length;c>100&&(c=100),r.textStyle={"font-size":c+"%"}}e.push(r)}),e},prizeIndex:function(){var t=this;return this.activity.items&&this.prize.id?this.activity.items.findIndex(function(e){return e.id===t.prize.id}):-1},isOdd:function(){return!!this.activity.items&&this.activity.items.length%2==1},imgStyle:function(){return this.activity.items&&this.activity.items.length?{"max-width":160/this.activity.items.length+"%"}:null}},mounted:function(){this.startanimation=!!this.lucky2},methods:{_getPartTurn:function(t){return(t-.5)/this.activity.items.length},_getPrizeTurn:function(t){return t/this.activity.items.length},goToLogin:function(){if(!this.isUserLogined&&!this.lucky2)return void this.$router.push({name:"AccountLogin",query:{redirect:this.$route.fullPath}})},go:function(){var t=this;if(!this.showWarn()){if(!this.isUserLogined)return this.lucky2?void this.$message({message:"请返回首页登录！",showtipv2:!0}):(this.$message({message:"对不起，请先登录！"}),void this.goToLogin());if(this.message)return void(this.lucky2?this.$message({message:this.message,showtipv2:!0}):this.$message({message:this.message}));if(!this.busy){if(this.leftTimes<=0)return void(this.lucky2?this.$message({message:"您当前无抽奖次数！",showtipv2:!0}):this.$message({message:"您当前无抽奖次数！"}));this.startanimation&&(this.startanimation=!1),setTimeout(function(){t.busy=!0,t.rotate=Math.round(t.rotate)+1,t.fakeRotating=!0,t.$emit("start")},10)}}},done:function(){if(!1===this.fakeRotating)return this.prize.message&&this.$message({message:this.prize.message,showtipv2:!!this.lucky2,time:3e3}),this.transition="1s ease-in",this.$emit("done"),void(this.busy=!1);-1===this.prizeIndex?(this.transition="1s linear",this.rotate++):this.fakeRotating&&(this.transition="5s ease-out",this.rotate+=4-this._getPrizeTurn(this.prizeIndex),this.fakeRotating=!1)},showWarn:function(){if(this.activity.onlyapp&&!/AKAPP/i.test(window.navigator.userAgent))return this.isShowWarning=!0,this.activity.downloadurl||(this.activity.downloadurl="/#/app"),!0}}}},699:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s(48),a=s.n(i),r=s(39),n=s.n(r),o=s(38),c=s.n(o),l=s(28),u=s.n(l),m=s(821),h=s.n(m),p=s(6);s(2);e.default={name:"PageLotteryWheel",data:function(){return{id:0,activity:{},leftTimes:-1,prize:{},fromRouter:{},messagesStore:[],messageIndex:0,pool:0,timerForPool:null,timerForMsg:null,timerForSingleMsg:null,isShowRule:!1,timerForScroller:null,mTop:0}},computed:{isUserLogined:function(){return this.$store.state.user.isUserLogined},systemDateTime:function(){return this.$store.state.systemDateTime},poolPrizeStyles:function(){for(var t=(""+this.pool).split(""),e=7-t.length,s=0;s++<e;)t.unshift("0");return t.map(function(t){return{transform:"translateY(-"+10*t+"%)"}})},message:function(){if(this.messagesStore.length)return this.messagesStore[this.messageIndex]},messages:function(){if(this.messagesStore.length){if(!this.activity.speed){var t=parseInt(this.messageIndex/4);return this.messagesStore.slice(4*t,4*(t+1))}return[].concat(u()(this.messagesStore),u()(this.messagesStore))}return[]}},created:function(){var t=this;return c()(n.a.mark(function e(){var s;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.$store.commit("setPage",{pageTitle:"幸运大转盘",className:"page-lucky"}),e.next=3,t.getId();case 3:if(t.id=e.sent,-1!==t.id){e.next=7;break}return t.activity={id:-1},e.abrupt("return");case 7:return t.getMessage(),t.getPool(),e.next=11,t.getActivity();case 11:if(t.activity=e.sent,!t.isUserLogined){e.next=17;break}return e.next=15,t.getLeftTimes();case 15:t.leftTimes=e.sent,t.leftTimes<0&&(s=t.$watch("systemDateTime",function(){var e=c()(n.a.mark(function e(i){return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(i&&!(t.activity&&new Date(t.activity.starttime)<=new Date(i)&&new Date(t.activity.endtime)>new Date(i))){e.next=5;break}return s(),e.next=4,t.getLeftTimes();case 4:t.leftTimes=e.sent;case 5:case"end":return e.stop()}},e,t)}));return function(t){return e.apply(this,arguments)}}()));case 17:t.timerForPool=setInterval(function(){t.getPool()},5e3),t.timerForMsg=setInterval(function(){t.getMessage()},2e4),t.timerForSingleMsg=setInterval(function(){t.messageIndex>=t.messagesStore.length-1?t.messageIndex=0:t.messageIndex++},2e3),t.startScroll();case 21:case"end":return e.stop()}},e,t)}))()},methods:{getId:function(){var t=this;return c()(n.a.mark(function e(){var s;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.$route.params.id){e.next=4;break}return e.abrupt("return",t.$route.params.id);case 4:return e.next=6,p.apiGetDrawLotteryList();case 6:if(s=e.sent,!s.data.list.length){e.next=9;break}return e.abrupt("return",s.data.list[0].id);case 9:return e.abrupt("return",-1);case 10:case"end":return e.stop()}},e,t)}))()},getActivity:function(){var t=this;return c()(n.a.mark(function e(){var s,i;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.apiGetDrawLottery({id:t.id});case 2:return s=e.sent,i=s.data,i.S?t.$message({message:i.S+": "+i.D}):i.items.length<3&&(i.items=i.items.concat(i.items)),e.abrupt("return",i);case 6:case"end":return e.stop()}},e,t)}))()},getLeftTimes:function(){var t=this;return c()(n.a.mark(function e(){var s;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.apiGetUserDrawLotteryTimes({id:t.id});case 2:if(s=e.sent,void 0!==s.data.A){e.next=6;break}return t.activity.error=s.data.D,e.abrupt("return",-1);case 6:return e.abrupt("return",s.data.A||0);case 7:case"end":return e.stop()}},e,t)}))()},getMessage:function(){var t=this;return c()(n.a.mark(function e(){var s;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.apiGetDrawLotteryMessage({id:t.id,pagesize:20});case 2:s=e.sent,s.data&&(t.messagesStore.length>200?(t.messagesStore=s.data,t.mTop=0):t.messagesStore=t.messagesStore.concat(s.data));case 4:case"end":return e.stop()}},e,t)}))()},getPool:function(){var t=this;return c()(n.a.mark(function e(){var s;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p.apiGetBounsPool({id:t.id});case 2:s=e.sent,t.pool=s.data.bounspool;case 4:case"end":return e.stop()}},e,t)}))()},start:function(){var t=this;return c()(n.a.mark(function e(){var s,i,r,o;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.leftTimes>0&&t.leftTimes--,t.prize={},s={},e.prev=3,e.next=6,p.apiDrawLottery({id:t.id});case 6:return i=e.sent,e.next=9,new a.a(function(t){setTimeout(function(){t()},15e3)});case 9:r=e.sent,s=i.data,e.next=16;break;case 13:e.prev=13,e.t0=e.catch(3),console.error(e.t0);case 16:if(!s.S){e.next=20;break}t.$message({message:s.S+": "+s.D}),e.next=30;break;case 20:return t.prize=s,e.prev=21,e.next=24,t.getLeftTimes();case 24:t.leftTimes=e.sent,e.next=30;break;case 27:e.prev=27,e.t1=e.catch(21),console.error(e.t1);case 30:t.prize&&t.prize.id||(o=t.activity.items.find(function(t){return t.isdefault}))&&(t.prize={id:o.id});case 31:case"end":return e.stop()}},e,t,[[3,13],[21,27]])}))()},goBack:function(){this.fromRouter.name&&this.fromRouter.name!==this.$route.name?this.$router.back():this.$router.push({name:"Home"})},startScroll:function(){var t=this;this.activity.speed&&(this.timerForScroller||(this.timerForScroller=setInterval(function(){!t.$refs.messages||t.messages.length<4||(t.mTop>=t.$refs.messages.clientHeight/2&&(t.mTop=0),t.mTop++)},1e3/(21*this.activity.speed))))},stopScroll:function(){this.timerForScroller&&clearInterval(this.timerForScroller),this.timerForScroller=null}},components:{LuckyWheel:h.a},beforeRouteEnter:function(t,e,s){s(function(t){t.fromRouter=e})},beforeDestroy:function(){this.timerForPool&&clearInterval(this.timerForPool),this.timerForMsg&&clearInterval(this.timerForMsg),this.timerForSingleMsg&&clearInterval(this.timerForSingleMsg),this.stopScroll()}}},821:function(t,e,s){var i=s(0)(s(614),s(965),null,null);t.exports=i.exports},907:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("main",{staticClass:"kd-body"},[s("div",{staticClass:"page-lucky__header"},[s("a",{staticClass:"page-lucky__button page-lucky__button--back",on:{click:function(e){return t.goBack()}}}),t._v(" "),s("router-link",{staticClass:"page-lucky__button page-lucky__button--record",attrs:{to:{name:"AccountPrizesList"}}},[t._v("抽奖记录")])],1),t._v(" "),s("div",{staticClass:"page-lucky__container"},[s("div",{staticClass:"page-lucky__pool"},[s("p",{staticClass:"page-lucky__pooldesc"},[t._v(t._s(t.activity.bounspool||" "))]),t._v(" "),s("ul",{staticClass:"nostyle page-lucky__poolnum"},t._l(t.poolPrizeStyles,function(e){return s("li",[s("ul",{staticClass:"nostyle page-lucky__poolinner",style:e},t._l(10,function(e,i){return s("li",[t._v(t._s(i))])}),0)])}),0),t._v(" "),s("div",{staticClass:"page-lucky__poolnotice"},[s("transition",{attrs:{name:"poolmsg"}},[t.message&&t.message.NickName?s("p",{key:t.messageIndex},[t._v("恭喜"),s("span",[t._v(t._s(t.message.NickName))]),t._v("用户抽取"),s("span",[t._v(t._s(t.message.PrizeName))])]):s("p",[t._v(" ")])])],1)]),t._v(" "),t.activity.desc?s("a",{staticClass:"page-lucky__button page-lucky__button--rule",on:{click:function(e){t.isShowRule=!0}}},[t._v("活动规则")]):t._e(),t._v(" "),s("lucky-wheel",{attrs:{activity:t.activity,"left-times":t.leftTimes,prize:t.prize},on:{start:t.start}}),t._v(" "),s("div",{staticClass:"page-lucky__box"},[s("h6",{staticClass:"page-lucky__boxtitle"},[t._v("\n                抽奖列表\n            ")]),t._v(" "),s("div",{staticClass:"page-lucky__table"},[t._m(0),t._v(" "),s("div",{staticClass:"page-lucky__tablescroll"},[s("ul",{ref:"messages",staticClass:"nostyle page-lucky__tablebody",style:{"margin-top":"-"+t.mTop+"px"}},[t._l(t.messages,function(e){return[s("li",[t._v(t._s(e.NickName))]),t._v(" "),s("li",[t._v(t._s(e.Times))]),t._v(" "),s("li",[t._v(t._s(e.PrizeName))]),t._v(" "),s("li",[t._v(t._s(e.AddDate))])]})],2)])])]),t._v(" "),s("transition",{attrs:{"enter-active-class":"animated zoom-in","leave-active-class":"animated bounce-out"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowRule,expression:"isShowRule"}],staticClass:"promptbox-wrapper prompt-in-game-rule"},[s("section",{staticClass:"promptbox"},[s("div",{staticClass:"prompt-head"},[t._v("活动规则")]),t._v(" "),s("div",{staticClass:"prompt-body article",domProps:{innerHTML:t._s(t.activity.desc)}}),t._v(" "),s("a",{staticClass:"prompt-close kd-close",attrs:{href:"javascript:;"},on:{click:function(e){t.isShowRule=!1}}},[t._v("close")])]),t._v(" "),s("div",{staticClass:"promptbox-overlay"})])])],1)])},staticRenderFns:[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ul",{staticClass:"nostyle clearfix page-lucky__tablehead"},[s("li",[t._v("会员名称")]),t._v(" "),s("li",[t._v("抽奖次数")]),t._v(" "),s("li",[t._v("奖品")]),t._v(" "),s("li",[t._v("参与时间")])])}]}},965:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"wheel"},[s("p",{staticClass:"wheel__header"},[s("span",{staticClass:"page-lucky__button page-lucky__button--wheel",style:{opacity:t.busy?0:1},on:{click:t.goToLogin}},[t.isUserLogined||t.lucky2?t.message?[t._v(t._s(t.message))]:t.leftTimes>=0?[t._v("还剩 "),s("i",{staticClass:"wheel__times"},[t._v(t._s(t.leftTimes))]),t._v(" 次机会")]:[t._v("点击抽奖")]:[t._v("点击此处登录抽奖")]],2)]),t._v(" "),s("div",{staticClass:"wheel__main"},[s("div",{staticClass:"wheel__lights"},t._m(0),0),t._v(" "),s("div",{staticClass:"wheel__body",class:{"wheel__body--odd":t.isOdd}},[s("div",{staticClass:"wheel__inner",class:{startanimation:t.startanimation},style:{transform:"rotate("+t.rotate+"turn)",transition:t.transition},on:{transitionend:t.done}},[t._l(t.prizesWithStyle,function(t){return s("div",{staticClass:"wheel__part",style:t.partStyle})}),t._v(" "),t._l(t.prizesWithStyle,function(e){return s("div",{staticClass:"wheel__prize",style:e.prizeStyle},[s("div",{staticClass:"wheel__prize-item"},[s("p",[t._v(t._s(e.prize.name))]),t._v(" "),void 0!==e.prize.showmode&&1!==e.prize.showmode||!e.prize.image?2===e.prize.showmode&&e.prize.worddesc?s("div",{staticClass:"wheel__prize-word",style:t.imgStyle},[s("div",{style:e.textStyle,domProps:{innerHTML:t._s(e.prize.worddesc)}})]):t._e():s("img",{staticClass:"wheel__prize-img",style:t.imgStyle,attrs:{src:e.prize.image}})])])})],2),t._v(" "),s("img",{staticClass:"wheel__pointer",attrs:{src:"/static/images/lucky-wheel-pointer.png"},on:{click:t.go}}),t._v(" "),s("a",{staticClass:"wheel__start",attrs:{href:"javascript:;"},on:{click:t.go}})])]),t._v(" "),s("transition",{attrs:{"enter-active-class":"animated zoom-in","leave-active-class":"animated bounce-out"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.isShowWarning,expression:"isShowWarning"}],staticClass:"lucky__warn"},[s("div",{staticClass:"overlay"}),t._v(" "),s("div",{staticClass:"lucky__warninner"},[s("div",{staticClass:"lucky__warnhead"},[s("a",{staticClass:"lucky__warnclose",on:{click:function(e){t.isShowWarning=!1}}},[s("i",{staticClass:"icon icon-times"})])]),t._v(" "),s("div",{staticClass:"lucky__warnbody"},[s("p",{staticClass:"lucky__warnmsg"},[t._v("\n                       "+t._s(t.activity.onlyapptip)+"\n                    ")])]),t._v(" "),s("div",{staticClass:"lucky__warnfoot"},[s("a",{staticClass:"lucky__warnbtn",attrs:{href:t.activity.downloadurl}},[t._v("前去下载")])])])])])],1)},staticRenderFns:[function(){var t=this,e=t.$createElement,s=t._self._c||e;return t._l(t.lights,function(e){return s("div",{staticClass:"wheel__light",class:{"wheel__light--sm":e%3==0,"wheel__light--sm2":e%3==1},style:{transform:"rotate("+e/t.lights+"turn)"}})})}]}}});