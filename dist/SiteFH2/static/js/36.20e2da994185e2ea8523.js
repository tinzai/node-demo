webpackJsonp([36],{347:function(e,s,t){var a=t(0)(t(645),null,null,null);e.exports=a.exports},645:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=t(864),n=t.n(a);s.default={extends:n.a}},680:function(e,s,t){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var a=t(53),n=t.n(a),c=t(6);s.default={name:"PageAccountMessagesList",data:function(){return{showRedMessages:0,messages:[],selectedMessages:[],redMessages:[],selectedRedMessages:[],totalPages:1,currentPage:1,totalCountOfMessages:0,totalCountOfRedMessages:0,recordsLengthPerPage:50,isPromptOpened:!1,message:{index:!1,title:"",date:"",content:""}}},created:function(){this.$store.commit("setPage",{pageTitle:this.$labels.accountMessagesList,className:"page-account-messages-list"}),this.fetchMessages()},methods:{switchMessage:function(e){this.currentPage=1,this.showRedMessages=e,this.selectedMessages=[],this.selectedRedMessages=[],this.fetchMessages()},fetchMessages:function(e){var s=this;if(/^\d+$/.test(e)||(e=this.currentPage),!(e>this.totalPages))return this.currentPage=e,this.$store.dispatch("uFetchMessages",{currentPage:this.currentPage,recordsLengthPerPage:this.recordsLengthPerPage,status:this.showRedMessages}).then(function(e){if(void 0===e.List)115!=e.S&&s.$message({message:e.S+": "+e.D,type:"warning"});else{var t=[],a=void 0;e.List.forEach(function(e){a={id:e.Id,title:e.Title,date:e.Date,description:e.Content||"",red:s.showRedMessages},t.push(a)}),0===s.showRedMessages?s.messages=t:1===s.showRedMessages&&(s.redMessages=t),s.currentPage=e.NowPage,0===s.showRedMessages?s.totalCountOfMessages=e.TotalCount:1===s.showRedMessages&&(s.totalCountOfRedMessages=e.TotalCount),s.totalPages=e.TotalPage}}).catch(function(e){console.log(e),s.$message({message:"获取消息列表出错啦！",type:"error",force:!0})})},fetchMessageDetail:function(e,s){var t=this;return this.$store.dispatch("uFetchMessageDetail",{id:e}).then(function(e){e.S?t.$message({message:e.S+": "+e.D,type:"warning"}):(t.message.index=s,t.message.title=e.Title,t.message.content=e.Content,t.message.date=e.Add_Date,0===t.showRedMessages&&(t.messages[s].red=1))}).catch(function(e){console.log(e),t.$message({message:"查看消息详情出错啦！",type:"error",force:!0})})},fetchUnredMessagesLength:function(){return this.$store.dispatch("uFetchUnredMessagesLength",{vm:this})},openPrompt:function(e,s){this.fetchMessageDetail(e,s),this.isPromptOpened=!0},closePrompt:function(){this.isPromptOpened=!1,this.message.title="",this.message.date="",this.message.content="",this.showRedMessages||(this.fetchMessages(),this.fetchUnredMessagesLength())},selectAllMessages:function(){var e=this.showRedMessages?this.redMessages:this.messages,s=[];e.forEach(function(e){s.push(e.id)}),this.showRedMessages?this.selectedRedMessages=s:this.selectedMessages=s},cancelSelectMessages:function(){this.showRedMessages?this.selectedRedMessages=[]:this.selectedMessages=[]},deleteMessage:function(e){var s=this;"object"===(void 0===e?"undefined":n()(e))&&(0===this.showRedMessages?e=this.selectedMessages:1===this.showRedMessages&&(e=this.selectedRedMessages),e=e.join(",")),c.apiDeleteMessage({i:e}).then(function(e){return e.json()}).then(function(e){"796"===e.S?(s.$message({message:"删除成功！",type:"success"}),s.selectedMessages=[],s.selectedRedMessages=[],s.fetchMessages(),s.fetchUnredMessagesLength()):s.$message({message:e.S+": "+e.D,type:"warning"})}).catch(function(e){console.log(e),s.$message({message:"删除消息出错啦！",type:"error",force:!0})})},setRedForSelected:function(){var e=this;0!==this.selectedMessages.length&&c.apiSetStatusOfMessageRed({i:this.selectedMessages.join(",")}).then(function(e){return e.json()}).then(function(s){"795"===s.S?(e.$message({message:"标记已读成功！",type:"success"}),e.selectedMessages=[],e.selectedRedMessages=[],e.fetchMessages(),e.fetchUnredMessagesLength()):e.$message({message:s.S+": "+s.D,type:"warning"})}).catch(function(s){console.log(s),e.$message({message:"删除消息出错啦！",type:"error",force:!0})})}}}},864:function(e,s,t){var a=t(0)(t(680),t(959),null,null);e.exports=a.exports},959:function(e,s){e.exports={render:function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("main",{staticClass:"kd-body"},[t("ul",{staticClass:"nostyle kd-container kd-row messages-nav"},[t("li",{class:{active:!e.showRedMessages}},[t("a",{attrs:{href:"javascript:;"},on:{click:function(s){return e.switchMessage(0)}}},[e._v("未读消息("+e._s(e.totalCountOfMessages)+")")])]),e._v(" "),t("li",{class:{active:e.showRedMessages}},[t("a",{attrs:{href:"javascript:;"},on:{click:function(s){return e.switchMessage(1)}}},[e._v("已读消息")])])]),e._v(" "),t("div",{staticClass:"kd-container message-actions"},[t("a",{attrs:{href:"javascript:;"},on:{click:e.selectAllMessages}},[e._v("选择所有")]),e._v(" "),e.selectedMessages.length>0||e.selectedRedMessages.length>0?t("a",{attrs:{href:"javascript:;"},on:{click:e.cancelSelectMessages}},[e._v("取消选择")]):e._e(),e._v(" "),e.selectedMessages.length>0?t("a",{attrs:{href:"javascript:;"},on:{click:e.setRedForSelected}},[e._v("标记已读")]):e._e(),e._v(" "),e.selectedMessages.length>0||e.selectedRedMessages.length>0?t("a",{attrs:{href:"javascript:;"},on:{click:e.deleteMessage}},[e._v("删除消息")]):e._e()]),e._v(" "),t("div",{staticClass:"kd-container"},[t("ul",{directives:[{name:"show",rawName:"v-show",value:!e.showRedMessages,expression:"!showRedMessages"}],staticClass:"nostyle messages-list"},[0===e.messages.length?t("li",[e._v("没有消息")]):e._l(e.messages,function(s,a){return t("li",{key:s.id,class:{red:s.red}},[t("kd-checkbox",{attrs:{cvalue:s.id},model:{value:e.selectedMessages,callback:function(s){e.selectedMessages=s},expression:"selectedMessages"}}),t("a",{on:{click:function(t){return e.openPrompt(s.id,a)}}},[e._v(e._s(s.title)+"-"+e._s(s.date))]),e._v(" "),t("a",{staticClass:"delete",on:{click:function(t){return e.deleteMessage(s.id)}}},[e._v("删除")])],1)})],2),e._v(" "),t("ul",{directives:[{name:"show",rawName:"v-show",value:e.showRedMessages,expression:"showRedMessages"}],staticClass:"nostyle messages-list"},[0===e.redMessages.length?t("li",[e._v("没有消息")]):e._l(e.redMessages,function(s,a){return t("li",{key:s.id,class:{red:s.red}},[t("kd-checkbox",{attrs:{cvalue:s.id},model:{value:e.selectedRedMessages,callback:function(s){e.selectedRedMessages=s},expression:"selectedRedMessages"}}),t("a",{on:{click:function(t){return e.openPrompt(s.id,a)}}},[e._v(e._s(s.title)+"-"+e._s(s.date))]),e._v(" "),t("a",{staticClass:"delete",on:{click:function(t){return e.deleteMessage(s.id)}}},[e._v("删除")])],1)})],2),e._v(" "),!e.showRedMessages&&e.messages.length>0||e.showRedMessages&&e.redMessages.length>0?t("kd-pager",{attrs:{currentPage:e.currentPage,totalPages:e.totalPages},on:{toPage:e.fetchMessages}}):e._e()],1),e._v(" "),t("transition",{attrs:{"enter-active-class":"animated zoom-in","leave-active-class":"animated bounce-out"}},[e.isPromptOpened?t("div",{staticClass:"promptbox-wrapper prompt-message"},[t("section",{staticClass:"promptbox"},[t("div",{staticClass:"prompt-head"},[e._v("消息详情")]),e._v(" "),t("div",{staticClass:"prompt-body"},[t("h5",{staticClass:"message-title"},[e._v(e._s(e.message.title))]),e._v(" "),t("p",[t("time",[e._v(e._s(e.message.date))])]),e._v(" "),t("div",{staticClass:"article"},[e._v(e._s(e.message.content))])]),e._v(" "),t("a",{staticClass:"prompt-close kd-close",on:{click:e.closePrompt}},[e._v("close")])]),e._v(" "),t("div",{staticClass:"promptbox-overlay"})]):e._e()])],1)},staticRenderFns:[]}}});